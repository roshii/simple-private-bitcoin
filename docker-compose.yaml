services:
  tor:
    build:
      context: tor
    container_name: tor
    image: r0shii/tor
    networks:
      - private
    volumes:
      - tor:/var/lib/tor
    restart: unless-stopped
  bitcoin:
    build:
      args:
        bitcoin_version_tag: ${BITCOIN_VERION_TAG:-v23.0}
      context: bitcoin
    container_name: bitcoin
    depends_on:
      - tor
    image: r0shii/bitcoin
    networks:
      - private
    volumes:
        - bitcoin:/var/lib/bitcoin
        - tor:/var/lib/tor:ro
        - ${BITCOIN_BLOCKS_MOUNTPOINT:-.data/bitcoin/blocks}:/srv/blocks
        - ${BITCOIN_DATA_MOUNTPOINT:-.data/bitcoin/data}:/srv/data
        - ${BITCOIN_WALLET_MOUNTPOINT:-.data/bitcoin/wallet}:/srv/wallet
    restart: unless-stopped
  joinmarket:
    build:
      args:
        joinmarket_version_tag: ${JOINMARKET_VERION_TAG:-v0.9.7}
      context: joinmarket
    container_name: joinmarket
    depends_on:
      - bitcoin
    image: r0shii/joinmarket
    networks:
      - private
    volumes:
      - bitcoin:/var/lib/bitcoin:ro
      - ${JOINMARKET_DATA_MOUNTPOINT:-.data/joinmarket}:/srv

networks:
  private:
    driver: bridge
    ipam:
      config:
        - subnet: 10.3.1.0/24

volumes:
  tor:
  bitcoin:
